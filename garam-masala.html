<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Garam Masala ‚Äî Unscramble Level Mode</title>
<style>
  :root{--bg:#071028;--card:#0f1724;--accent:#ffb86b;--good:#4ade80;--bad:#ff6b6b;--muted:#9fb0d1}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;min-height:100vh;background:linear-gradient(180deg,var(--bg),#02121b);color:#fff;display:flex;align-items:center;justify-content:center;padding:16px}
  .wrap{width:min(920px,98vw);background:linear-gradient(180deg,#081428,#04101a);border-radius:12px;padding:16px;box-shadow:0 12px 30px rgba(0,0,0,.6)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{margin:0;font-size:18px}
  .meta{color:var(--muted);font-size:13px}
  .board{display:grid;grid-template-columns:1fr 320px;gap:14px;margin-top:12px}
  @media (max-width:860px){ .board{grid-template-columns:1fr} }
  .card{background:linear-gradient(180deg,#0f1724,#071428);padding:14px;border-radius:10px}
  .scramble{font-size:34px;text-align:center;font-weight:900;color:var(--accent);padding:18px 8px;border-radius:8px;letter-spacing:2px}
  .bar{height:10px;background:rgba(255,255,255,0.05);border-radius:999px;overflow:hidden;margin-top:8px}
  .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#fff);width:0%}
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
  button{background:var(--accent);border:0;color:#111;padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer}
  button.alt{background:#183243;color:#fff}
  .small{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}
  .side{display:flex;flex-direction:column;gap:12px}
  .box{background:rgba(255,255,255,0.03);padding:12px;border-radius:10px}
  .level{font-weight:800;font-size:16px}
  .progress{font-size:13px;color:var(--muted)}
  .list{max-height:220px;overflow:auto;padding-top:6px}
  .row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.03)}
  .mutedBtn{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:6px 8px;border-radius:8px;cursor:pointer}
  .big{font-size:20px;font-weight:800}
  .center{display:flex;justify-content:center;gap:8px}
  footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
  input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;margin-top:10px}
  .mutedSmall{font-size:12px;color:var(--muted)}
  /* correct hit animations */
.scramble{ position:relative } /* ensure the word container is a positioning context */
@keyframes pop {
  0% { transform: scale(1); filter: drop-shadow(0 0 0 transparent); }
  40% { transform: scale(1.12); filter: drop-shadow(0 14px 20px rgba(0,0,0,0.25)); }
  100% { transform: scale(1); filter: drop-shadow(0 0 0 transparent); }
}
.pop {
  animation: pop 420ms cubic-bezier(.2,.8,.25,1);
}
.floatPlus {
  position: absolute;
  left: 50%;
  top: 30%;
  transform: translate(-50%,0);
  font-weight:900;
  font-size:22px;
  color: #4ade80;
  opacity: 1;
  pointer-events: none;
  transition: transform 900ms ease-out, opacity 900ms ease-out;
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Garam Masala ‚Äî Unscramble Level Mode</h1>
      <div class="meta">Each word = <strong>3:00</strong> ‚Ä¢ 10 words per level ‚Ä¢ Type answer and SUBMIT</div>
    </div>
    <div class="meta" id="statusTop">Level 1 ‚Ä¢ Word 1/10</div>
  </header>

  <div class="board">
    <!-- main -->
    <div class="card">
      <div id="mainArea">
        <div class="scramble" id="scrambleDisplay">‚Äî</div>
        <div class="bar" title="Time left"><i id="timeBar"></i></div>
        <div class="center" style="margin-top:12px">
          <div class="big" id="timerDisplay">03:00</div>
        </div>

        <div style="margin-top:12px">
          <input id="answerInput" type="text" placeholder="Type your unscrambled word here" autocomplete="off" autocapitalize="none" />
        </div>

        <div class="controls">
          <button id="submitBtn">SUBMIT ‚úî</button>
          <button id="skipBtn" class="alt">SKIP ‚è≠</button>
          <button id="giveBtn" class="alt">GIVE UP ‚ùå</button>
          <button id="revealBtn" class="mutedBtn">REVEAL</button>
        </div>

        <div class="center" style="margin-top:10px">
          <button id="pauseBtn" class="mutedBtn">PAUSE</button>
          <button id="resumeBtn" class="mutedBtn" style="display:none">RESUME</button>
        </div>

        <div class="small">Tip: family can discuss during 3 minutes ‚Äî type answer and press SUBMIT. Autocheck is relaxed with small typo tolerance.</div>
      </div>

      <div id="levelSummary" style="display:none;margin-top:12px" class="box"></div>
    </div>

    <!-- side -->
    <div class="side">
      <div class="box">
        <div class="level">Progress</div>
        <div class="progress">Level <span id="levelNum">1</span> / <span id="totalLevels">1</span></div>
        <div style="margin-top:8px">Word: <strong id="wordIdx">1</strong> / 10</div>
        <div style="margin-top:8px">Score: <strong id="score">0</strong></div>
        <div style="margin-top:8px">Streak: <strong id="streak">0</strong></div>
      </div>

      <div class="box">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="mutedBtn" id="restartLevel">Restart Level</div>
          <div class="mutedBtn" id="resetGame">Reset Game</div>
        </div>
        <div style="margin-top:8px" class="mutedBtn" id="shareBtn">Share Game</div>
      </div>

      <div class="box">
        <div class="small">Level Words (scrambled)</div>
        <div class="list" id="wordsList"></div>
      </div>
    </div>
  </div>

  <footer>
    <div id="footerArea" style="display:block">
      Tip: family can discuss while timer runs ‚Äî pure masala time. üçµüé¨
    </div>
  </footer>
</div>

<div id="winOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);align-items:center;justify-content:center;z-index:9999">
  <div style="background:linear-gradient(180deg,#0f1724,#071428);padding:20px;border-radius:12px;color:#fff;max-width:720px;margin:24px">
    <div class="win" style="text-align:center">
      <div style="font-size:22px;font-weight:900">üéâ CONGRATULATIONS ‚Äî YOU MASTERED GARÃ≤AM MASALA! üéâ</div>
      <div style="margin-top:8px;color:var(--muted)">You finished all levels, unscrambled filmy flavour, and sprinkled your own masala on every word. Proud moment, bhidu!</div>
      <div style="margin-top:12px">
        <button id="replayBtn">Replay Game</button>
        <button id="suggestBtn" class="alt">Suggest a Word</button>
        <button id="feedbackBtn" class="alt">Give Feedback</button>
        <button id="closeWin" class="mutedBtn">Close</button>
      </div>
      <div style="margin-top:12px;color:var(--muted)">Share the fun ‚Äî let friends try the Garam Masala challenge!</div>
    </div>
  </div>
</div>

<script>
/* =================== Word list (final cleaned words) =================== */
const ALL_WORDS = [
"DDLJ","SHOLAY","BARFI","ROCKY","TAMASHA","DEVDAS","ANAND","DON","DHOOM","TIGER","KABIR","DILSE","RAAZI","QUEEN","FALTU","URI","GULLY","PUSHPA","ANIMAL","JAWAAN","PATHAAN","KALKI",
"SIMRAN","RAJ","VIJAY","POOJA","ROHIT","RADHA","ARJUN","KABIR_NAME","NISHA","SALMAN","ANJALI","RAHUL","PREM","MADHURI","KARAN",
"PYAAR","DOSTI","SUKOON","ZINDAGI","KISMAT","JUNOON","ANDAZ","RISHTA","DIL","YAARI","KARMA","MASALA","DESI","TAPORI","BIJLI","JABRA","MASTI",
"SITAR","MAALA","GHODA","RANG","DHOOP","DIYA","GHUNGROO","AUTO","MAUSAM",
"SAJNA","PIYA","MEHFIL","RAABTA","JASHN","NIGAAH","ISHQ","NOOR","JANNAT","FITOOR","AWAARA","MITWA","GALTI SE MISTAKE","KESARIYA","PATIALA PEG","ZARA ZARA","PEHLA NASHA","RADHA_SONG","ASHIQUI","JHOOM","TUM HI HO","SAIYAARA","SATRANGI","JABSE","SAAWARIYA"
];

/* =================== Settings =================== */
const WORDS_PER_LEVEL = 10;
const VISIBLE_MS = 180000; // 3 minutes

/* =================== State =================== */
let shuffled = [];
let levels = [];
let currentLevel = 0;
let currentIndex = 0;
let score = 0, streak = 0;
let timer = null, startTS = 0, remaining = 0, paused = false;
let high = Number(localStorage.getItem('gm_high') || 0);

/* =================== DOM refs =================== */
const scrambleDisplay = document.getElementById('scrambleDisplay');
const timeBar = document.getElementById('timeBar');
const timerDisplay = document.getElementById('timerDisplay');
const levelNumEl = document.getElementById('levelNum');
const totalLevelsEl = document.getElementById('totalLevels');
const wordIdxEl = document.getElementById('wordIdx');
const scoreEl = document.getElementById('score');
const streakEl = document.getElementById('streak');
const statusTop = document.getElementById('statusTop');
const wordsList = document.getElementById('wordsList');
const levelSummary = document.getElementById('levelSummary');
const winOverlay = document.getElementById('winOverlay');
const answerInput = document.getElementById('answerInput');

/* =================== Utility =================== */
function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function formatMs(ms){
  const s = Math.max(0,Math.ceil(ms/1000));
  const mm = Math.floor(s/60).toString().padStart(2,'0');
  const ss = (s%60).toString().padStart(2,'0');
  return mm+':'+ss;
}
function beep(freq,dur){ try{ const a=new (window.AudioContext||window.webkitAudioContext)(); const o=a.createOscillator(), g=a.createGain(); o.frequency.value=freq; o.connect(g); g.connect(a.destination); o.start(); setTimeout(()=>{ o.stop(); a.close().catch(()=>{}); },dur);}catch(e){} }
/* small confetti burst (lightweight) */
function confettiBurstSmall(){
  const container = document.getElementById('scrambleDisplay');
  for(let i=0;i<20;i++){
    const el = document.createElement('div');
    el.style.position = 'absolute';
    el.style.left = (50 + (Math.random()*120-60)) + '%';
    el.style.top = (40 + Math.random()*10) + '%';
    el.style.width = '8px';
    el.style.height = '10px';
    el.style.background = ['#ffd166','#ff6b6b','#4ade80','#9bf6ff'][Math.floor(Math.random()*4)];
    el.style.borderRadius = '2px';
    el.style.opacity = '0.98';
    el.style.transform = 'translateY(0) rotate('+ (Math.random()*360) +'deg)';
    el.style.transition = 'transform 900ms cubic-bezier(.2,.7,.2,1), opacity 900ms';
    container.appendChild(el);
    setTimeout(()=>{ el.style.transform = 'translateY(120px) rotate('+ (360+Math.random()*720) +'deg)'; el.style.opacity = '0'; }, 20 + Math.random()*120);
    setTimeout(()=>el.remove(), 1000);
  }
}

/* show green pop + floating +1 then call nextWord after animation */
function showCorrectAnimation(){
  // pop the word
  scrambleDisplay.classList.add('pop');
  const prevColor = scrambleDisplay.style.color;
  scrambleDisplay.style.color = 'var(--good)';

  // floating +1
  const plus = document.createElement('div');
  plus.className = 'floatPlus';
  plus.innerText = '+1';
  scrambleDisplay.appendChild(plus);
  // animate up & fade
  requestAnimationFrame(()=> {
    plus.style.transform = 'translate(-50%,-60px) scale(1.0)';
    plus.style.opacity = '0';
  });

  confettiBurstSmall();
  beep(1100,100);

  // cleanup & continue
  setTimeout(()=>{
    scrambleDisplay.classList.remove('pop');
    scrambleDisplay.style.color = ''; // revert to CSS color
    plus.remove();
    // proceed to next word
    nextWord();
  }, 700); // keep in sync with pop/confetti
}
/* small cleaner for matching */
function clean(s){ return (s||'').toLowerCase().replace(/[^a-z0-9]/g,''); }

/* Levenshtein distance for tolerant matching */
function distance(a,b){
  a=clean(a); b=clean(b);
  const A=a.length, B=b.length;
  if(A===0) return B; if(B===0) return A;
  const dp = Array.from({length:A+1}, ()=>Array(B+1).fill(0));
  for(let i=0;i<=A;i++) dp[i][0]=i;
  for(let j=0;j<=B;j++) dp[0][j]=j;
  for(let i=1;i<=A;i++){
    for(let j=1;j<=B;j++){
      dp[i][j]=Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+(a[i-1]===b[j-1]?0:1));
    }
  }
  return dp[A][B];
}

/* scramble helper: keep punctuation/space groups, scramble letters within whole string */
function scrambleWord(original){
  // if multi-word (has spaces), scramble each token separately but keep token order
  const tokens = String(original).split(' ');
  const scrambledTokens = tokens.map(token=>{
    // preserve length-1 or short tokens by simple shuffle but ensure not equal
    const chars = token.split('');
    // try shuffle up to 10 times to avoid same
    for(let t=0;t<10;t++){
      for(let i=chars.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [chars[i],chars[j]]=[chars[j],chars[i]];
      }
      const s = chars.join('');
      if(s.toLowerCase() !== token.toLowerCase()) return s;
    }
    return token.split('').reverse().join('');
  });
  return scrambledTokens.join(' ');
}

/* =================== Prepare levels =================== */
function prepareLevels(){
  shuffled = shuffleArray(ALL_WORDS.slice());
  levels = [];
  for(let i=0;i<shuffled.length;i+=WORDS_PER_LEVEL){
    levels.push(shuffled.slice(i, i+WORDS_PER_LEVEL));
  }
  totalLevelsEl.innerText = levels.length;
  // load progress if any
  const saved = localStorage.getItem('gm_progress');
  if(saved){
    try{
      const p = JSON.parse(saved);
      currentLevel = p.currentLevel || 0;
      currentIndex = p.currentIndex || 0;
      score = p.score || 0;
      streak = p.streak || 0;
    }catch(e){}
  }
}

/* =================== UI rendering =================== */
function renderWordsList(){
  wordsList.innerHTML = '';
  const lvl = levels[currentLevel] || [];
  lvl.forEach((w,i)=>{
    const div = document.createElement('div'); div.className='row';
    const scr = scrambleWord(w);
    div.innerHTML = `<div style="flex:1">${escapeHtml(scr)}</div><div style="width:64px;text-align:right">${i<currentIndex?'<span style="color:#4ade80">‚úî</span>':(i===currentIndex?'<span style="color:var(--accent)">‚óè</span>':'')}</div>`;
    wordsList.appendChild(div);
  });
}
function updateHeader(){
  const L = levels.length;
  document.getElementById('levelNum').innerText = currentLevel+1;
  totalLevelsEl.innerText = L;
  wordIdxEl.innerText = Math.min(currentIndex+1, (levels[currentLevel]||[]).length);
  scoreEl.innerText = score;
  streakEl.innerText = streak;
  statusTop.innerText = `Level ${currentLevel+1} ‚Ä¢ Word ${Math.min(currentIndex+1, (levels[currentLevel]||[]).length)}/${WORDS_PER_LEVEL}`;
}

/* =================== Core: show current scrambled & start timer =================== */
let currentOriginal = '';
function showCurrent(){
  const lvl = levels[currentLevel] || [];
  if(currentIndex >= lvl.length){ finishLevel(); return; }
  const orig = lvl[currentIndex];
  currentOriginal = orig;
  const scr = scrambleWord(orig);
  scrambleDisplay.innerText = scr;
  answerInput.value = '';
  answerInput.focus();
  renderWordsList();
  updateHeader();
  startCountdown(VISIBLE_MS);
}

/* countdown */
function startCountdown(duration){
  clearTimeout(timer);
  paused = false;
  remaining = duration;
  startTS = Date.now();
  timeBar.style.transition = 'none';
  timeBar.style.width = '100%';
  setTimeout(()=>{ timeBar.style.transition = 'width '+(duration/1000)+'s linear'; timeBar.style.width='0%'; },20);
  updateTimerDisplay();
  timer = setTimeout(()=>{ onMiss(); }, duration);
}
function updateTimerDisplay(){
  if(paused){
    timerDisplay.innerText = formatMs(remaining);
  } else {
    const elapsed = Date.now() - startTS;
    const left = Math.max(0, remaining - elapsed);
    timerDisplay.innerText = formatMs(left);
    setTimeout(updateTimerDisplay, 300);
  }
}

/* pause/resume */
function pauseGame(){
  if(paused) return;
  paused = true;
  clearTimeout(timer);
  const elapsed = Date.now() - startTS;
  remaining = Math.max(0, remaining - elapsed);
  timeBar.style.transition = 'none';
  const pct = (remaining / VISIBLE_MS) * 100;
  timeBar.style.width = pct + '%';
  document.getElementById('pauseBtn').style.display='none';
  document.getElementById('resumeBtn').style.display='inline-block';
  beep(300,80);
  updateTimerDisplay();
}
function resumeGame(){
  if(!paused) return;
  paused = false;
  document.getElementById('pauseBtn').style.display='inline-block';
  document.getElementById('resumeBtn').style.display='none';
  startTS = Date.now();
  timeBar.style.transition = 'none';
  timeBar.style.width = (remaining / VISIBLE_MS * 100) + '%';
  setTimeout(()=>{ timeBar.style.transition = 'width '+(remaining/1000)+'s linear'; timeBar.style.width = '0%'; },20);
  timer = setTimeout(()=>{ onMiss(); }, remaining);
  updateTimerDisplay();
  beep(700,80);
}

/* =================== Actions: SUBMIT / SKIP / GIVE UP / REVEAL / MISS =================== */
function acceptAnswer(input){
  const a = clean(input);
  const b = clean(currentOriginal);
  if(!a) return false;
  // direct match
  if(a === b) return true;
  // fuzzy tolerance for longer words
  if(Math.max(a.length, b.length) > 4){
    const d = distance(a,b);
    if(d <= 2) return true;
  }
  return false;
}

function onSubmit(){
  if(paused) return;
  const val = answerInput.value.trim();
  if(!val){ alert('Type your guess then press SUBMIT'); answerInput.focus(); return; }
  if(acceptAnswer(val)){
    clearTimeout(timer);
    score += 1;
    streak += 1;
     // play animation then nextWord()
    showCorrectAnimation();
  } else {
    // wrong
    clearTimeout(timer);
    score = Math.max(-999, score - 1);
    streak = 0;
    beep(220,140);
    alert('Wrong! The correct word was: ' + currentOriginal);
    nextWord();
  }
}

function onSkip(){
  if(!confirm('Skip this word?')) return;
  clearTimeout(timer);
  streak = 0;
  nextWord();
}
function onGiveUp(){
  if(!confirm('Give up on this word? (‚àí1)')) return;
  clearTimeout(timer);
  score = Math.max(-999, score - 1);
  streak = 0;
  nextWord();
}
function onReveal(){
  clearTimeout(timer);
  alert('Answer: ' + currentOriginal);
  nextWord();
}
function onMiss(){
  // timed out
  score = Math.max(-999, score - 1);
  streak = 0;
  beep(220,140);
  alert('Time up! The answer was: ' + currentOriginal);
  nextWord();
}

/* next word */
function nextWord(){
  currentIndex++;
  saveProgress();
  setTimeout(()=>{
    updateHeader();
    if(currentIndex >= (levels[currentLevel]||[]).length){
      finishLevel();
    } else {
      showCurrent();
    }
  }, 450);
}

/* finish level */
function finishLevel(){
  clearTimeout(timer);
  const lvlWords = levels[currentLevel] || [];
  levelSummary.style.display = 'block';
  levelSummary.innerHTML = `<div style="font-weight:900">Level ${currentLevel+1} Complete</div>
    <div class="small" style="margin-top:8px">Words in this level (original):</div>
    <div style="margin-top:8px">${lvlWords.map(w=>'<div style="padding:4px 0">'+escapeHtml(w)+'</div>').join('')}</div>
    <div style="margin-top:8px">Score: <strong>${score}</strong> ‚Ä¢ Streak: <strong>${streak}</strong></div>
    <div style="margin-top:10px"><button id="nextLevelBtn">Next Level</button> <button id="replayLevelBtn" class="alt">Replay Level</button></div>`;
  document.getElementById('nextLevelBtn').addEventListener('click', ()=>{
    currentLevel++;
    currentIndex = 0;
    levelSummary.style.display = 'none';
    if(currentLevel >= levels.length){
      onWin();
    } else {
      saveProgress();
      showCurrent();
    }
  });
  document.getElementById('replayLevelBtn').addEventListener('click', ()=>{
    levels[currentLevel] = shuffleArray(levels[currentLevel].slice());
    currentIndex = 0;
    levelSummary.style.display = 'none';
    saveProgress();
    showCurrent();
  });
}

/* win */
function onWin(){
  clearTimeout(timer);
  winOverlay.style.display = 'flex';
  if(score > high){ high = score; localStorage.setItem('gm_high', high); }
  document.getElementById('replayBtn').addEventListener('click', ()=>{
    winOverlay.style.display = 'none';
    restartGame();
  });
  document.getElementById('suggestBtn').addEventListener('click', ()=>{ promptSuggest(); });
  document.getElementById('feedbackBtn').addEventListener('click', ()=>{ promptFeedback(); });
  document.getElementById('closeWin').addEventListener('click', ()=>{ winOverlay.style.display = 'none'; });
}

/* restart / reset */
function restartGame(){
  currentLevel = 0; currentIndex = 0; score = 0; streak = 0;
  prepareLevels();
  saveProgress(true);
  showCurrent();
}
function resetGame(){
  if(!confirm('Reset game progress and start fresh?')) return;
  localStorage.removeItem('gm_progress');
  localStorage.removeItem('gm_suggestions');
  restartGame();
}

/* progress save */
function saveProgress(forceSave){
  const p = { currentLevel, currentIndex, score, streak, timestamp: Date.now() };
  localStorage.setItem('gm_progress', JSON.stringify(p));
  if(forceSave) localStorage.setItem('gm_savedWords', JSON.stringify(levels));
}

/* suggestions / feedback */
function promptSuggest(){
  const s = prompt('Suggest a Bollywood word (one word or short phrase). It will be saved locally and you can optionally email it.', '');
  if(!s) return;
  const list = JSON.parse(localStorage.getItem('gm_suggestions')||'[]');
  list.push({word:s, when:new Date().toISOString()});
  localStorage.setItem('gm_suggestions', JSON.stringify(list));
  const subject = encodeURIComponent('Garam Masala ‚Äî Word Suggestion');
  const body = encodeURIComponent('I suggest this word: ' + s);
  window.location.href = `mailto:your-email@example.com?subject=${subject}&body=${body}`;
}
function promptFeedback(){
  const f = prompt('Any feedback? (short)', '');
  if(!f) return;
  const fb = JSON.parse(localStorage.getItem('gm_feedback')||'[]');
  fb.push({text:f, when:new Date().toISOString()});
  localStorage.setItem('gm_feedback', JSON.stringify(fb));
  alert('Thanks boss ‚Äî feedback saved!');
}

/* share */
function shareGame(){
  const url = location.href;
  const text = 'Try Garam Masala ‚Äî my family unscramble game!';
  if(navigator.share){
    navigator.share({title:'Garam Masala', text, url}).catch(()=>{ copyToClipboard(url); alert('Link copied'); });
  } else {
    copyToClipboard(url);
    alert('Link copied to clipboard ‚Äî share it!');
  }
}
function copyToClipboard(text){
  try{ navigator.clipboard.writeText(text); }catch(e){ const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }
}

/* helpers */
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* =================== Bind UI buttons =================== */
document.getElementById('submitBtn').addEventListener('click', ()=>{ onSubmit(); updateHeader(); saveProgress(); });
document.getElementById('skipBtn').addEventListener('click', ()=>{ onSkip(); });
document.getElementById('giveBtn').addEventListener('click', ()=>{ onGiveUp(); });
document.getElementById('revealBtn').addEventListener('click', ()=>{ onReveal(); });
document.getElementById('pauseBtn').addEventListener('click', ()=>{ pauseGame(); });
document.getElementById('resumeBtn').addEventListener('click', ()=>{ resumeGame(); });
document.getElementById('restartLevel').addEventListener('click', ()=>{ if(confirm('Restart this level?')){ levels[currentLevel] = shuffleArray(levels[currentLevel].slice()); currentIndex=0; saveProgress(true); showCurrent(); } });
document.getElementById('resetGame').addEventListener('click', ()=>{ resetGame(); });
document.getElementById('shareBtn').addEventListener('click', ()=>{ shareGame(); });

/* keyboard: Enter submits */
answerInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ onSubmit(); } });

/* =================== Init =================== */
prepareLevels();
updateHeader();
showCurrent();
saveProgress(true);

/* save before unload */
window.addEventListener('beforeunload', ()=>{ saveProgress(); });

</script>
</body>
</html>